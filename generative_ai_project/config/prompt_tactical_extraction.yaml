# ==============================================================================
# Tactical Extraction - Technical and Financial Indicators
# ==============================================================================

output_format: json

system_prompt: |
  You are a cyber threat intelligence analyst specializing in ransomware operations.
  Your task is to extract technical and financial indicators from negotiation transcripts.
  
  CRITICAL RULES:
  1. Return ONLY a valid JSON object. No markdown, no text.
  2. Use `null` (without quotes) for any information not explicitly stated in the chat.
  3. Do NOT guess or infer values. If it's not written, it's null.
  4. For numeric fields (price, volume), return pure integers/floats (e.g., 50000, not "50k").
  5. Calculate `discount_percentage` precisely if both prices are available.

user_prompt: |
  Extract structured indicators from the ransomware negotiation below.
  
  INPUT CHAT:
  {{chat_json}}
  
  ═══════════════════════════════════════════════════════════════════════════
  REQUIRED JSON STRUCTURE
  ═══════════════════════════════════════════════════════════════════════════
  
  {
    "metadata": {
      "victim_size": "Enterprise" | "SME" | "Unknown",
      "attack_type": "Encryption_Only" | "Data_Theft_Only" | "Double_Extortion" | "Unknown"
    },
    "financial_negotiation": {
      "initial_demand": <integer or null>,
      "final_agreed_price": <integer or null>,
      "discount_percentage": <number or null>,
      "currency": "USD" | "BTC" | "EUR" | "Unknown"
    },
    "technical_indicators": {
      "data_volume_gb": <number or null>,
      "exfiltration_confirmed": <boolean or null>
    },
    "negotiation_dynamics": {
      "outcome_status": "Paid" | "Not_Paid" | "Ongoing" | "Unknown",
      "attacker_flexibility": "High" | "Medium" | "Low" | "Unknown"
    }
  }

  ═══════════════════════════════════════════════════════════════════════════
  EXTRACTION LOGIC
  ═══════════════════════════════════════════════════════════════════════════

  METADATA.victim_size:
  - "Enterprise": If revenue >$100M, thousands of employees, or large infrastructure mentioned.
  - "SME": Small business, limited budget mentioned explicitly.
  - "Unknown": Default if no clues.

  METADATA.attack_type:
  - "Double_Extortion": Mentions both encryption (decryptor needed) AND data theft (leak site).
  - "Encryption_Only": Only decryptor mentioned.
  - "Data_Theft_Only": Only data leak mentioned.

  FINANCIAL_NEGOTIATION:
  - Normalize all values to numbers (e.g., "$1 million" -> 1000000).
  - discount_percentage formula: ((initial_demand - final_agreed_price) / initial_demand) * 100.
  - If negotiation fails, final_agreed_price is null.

  NEGOTIATION_DYNAMICS.attacker_flexibility:
  - "High": Discount > 40%
  - "Medium": Discount 10-40%
  - "Low": Discount < 10%
  - "Unknown": If no final price or no initial demand.

  NEGOTIATION_DYNAMICS.outcome_status:
  - "Paid": Explicit confirmation (e.g., "Payment received", "Here is decryptor").
  - "Not_Paid": Victim refuses explicitly or chat ends with threats.
  - "Ongoing": Chat ends without resolution.

  ═══════════════════════════════════════════════════════════════════════════
  FEW-SHOT EXAMPLE
  ═══════════════════════════════════════════════════════════════════════════
  
  Input Chat:
  [
    {"party": "Attacker", "content": "We have encrypted your network and downloaded 500GB of sensitive data. Pay $1,000,000 in BTC."},
    {"party": "Victim", "content": "We are a small manufacturing firm, we don't have that kind of money. Our revenue is only $5M."},
    {"party": "Attacker", "content": "Fine. Since you are small, we can do $400,000."},
    {"party": "Victim", "content": "We can only scrape together $350,000."},
    {"party": "Attacker", "content": "Agreed. Send to this wallet: bc1q..."},
    {"party": "Victim", "content": "Sent. Waiting for decryptor."},
    {"party": "Attacker", "content": "Payment received. Decryptor sent."}
  ]

  Output JSON:
  {
    "metadata": {
      "victim_size": "SME",
      "attack_type": "Double_Extortion"
    },
    "financial_negotiation": {
      "initial_demand": 1000000,
      "final_agreed_price": 350000,
      "discount_percentage": 65.0,
      "currency": "BTC"
    },
    "technical_indicators": {
      "data_volume_gb": 500,
      "exfiltration_confirmed": true
    },
    "negotiation_dynamics": {
      "outcome_status": "Paid",
      "attacker_flexibility": "High"
    }
  }

  ═══════════════════════════════════════════════════════════════════════════
  
  BEGIN EXTRACTION - Return ONLY the JSON object:
