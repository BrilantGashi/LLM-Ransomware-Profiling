# ==============================================================================
# Tactical Extraction - Technical and Financial Indicators
# ==============================================================================

output_format: json

system_prompt: |
  You are a cyber threat intelligence analyst specializing in ransomware operations. Extract technical and financial indicators from negotiation transcripts. Return strict JSON following the provided schema exactly.

user_prompt: |
  Task
  
  You will extract structured indicators from the ransomware negotiation below. The chat is provided as a JSON list of dictionaries with fields "party" (either "Attacker" or "Victim") and "message".
  
  Return a single JSON object using this schema:
  
  {
    "metadata": {
      "victim_size": "Enterprise | SME | Unknown",
      "attack_type": "Encryption_Only | Data_Theft_Only | Double_Extortion | Unknown"
    },
    "financial_negotiation": {
      "initial_demand": <integer or null>,
      "final_agreed_price": <integer or null>,
      "discount_percentage": <number or null>,
      "currency": "USD | BTC | EUR | Unknown"
    },
    "technical_indicators": {
      "data_volume_gb": <number or null>,
      "exfiltration_confirmed": <boolean or null>
    },
    "negotiation_dynamics": {
      "outcome_status": "Paid | Not_Paid | Ongoing | Unknown",
      "attacker_flexibility": "High | Medium | Low | Unknown"
    }
  }
  
  
  Labels (threat intelligence indicators)
  
  METADATA:
  
  victim_size (choose one):
  - Enterprise — large organization with revenue exceeding $100M, thousands of employees, or extensive infrastructure mentioned.
  - SME — small or medium business, explicit mention of limited budget or small scale.
  - Unknown — insufficient evidence in the chat to classify.
  
  attack_type (choose one):
  - Encryption_Only — only file encryption and decryptor delivery mentioned.
  - Data_Theft_Only — only data exfiltration and potential leak mentioned.
  - Double_Extortion — both encryption (decryptor needed) and data theft (leak threat) present.
  - Unknown — insufficient evidence in the chat to classify.
  
  
  FINANCIAL_NEGOTIATION:
  
  initial_demand (integer or null):
  - The first ransom amount stated by the attacker, normalized to numeric format.
  - Convert text amounts to pure integers (e.g., "$1 million" becomes 1000000, "500k" becomes 500000).
  - Use null if no initial demand is explicitly stated.
  
  final_agreed_price (integer or null):
  - The amount both parties agree upon, normalized to numeric format.
  - Use null if negotiation does not reach agreement or if chat ends without resolution.
  
  discount_percentage (number or null):
  - Calculate using: ((initial_demand - final_agreed_price) / initial_demand) × 100.
  - Use null if either initial_demand or final_agreed_price is unavailable.
  
  currency (choose one):
  - USD | BTC | EUR — based on explicit mention in the chat.
  - Unknown — if currency is not specified or unclear.
  
  
  TECHNICAL_INDICATORS:
  
  data_volume_gb (number or null):
  - Amount of data exfiltrated, normalized to gigabytes.
  - Convert units if necessary (TB to GB, etc.).
  - Use null if data volume is not mentioned.
  
  exfiltration_confirmed (boolean or null):
  - true — if attacker explicitly states data was stolen, downloaded, or exfiltrated.
  - false — if attacker explicitly states no data theft occurred (encryption only).
  - null — if data exfiltration is not discussed in the chat.
  
  
  NEGOTIATION_DYNAMICS:
  
  outcome_status (choose one):
  - Paid — explicit confirmation of payment completion (e.g., "Payment received", "Decryptor sent").
  - Not_Paid — victim explicitly refuses payment or chat ends with escalating threats.
  - Ongoing — chat ends without clear resolution or payment confirmation.
  - Unknown — insufficient evidence to determine outcome.
  
  attacker_flexibility (choose one):
  - High — discount exceeds 40% from initial demand.
  - Medium — discount between 10% and 40% from initial demand.
  - Low — discount less than 10% from initial demand.
  - Unknown — if discount_percentage cannot be calculated.
  
  
  Guidance
  
  - Extract values only from explicit statements in the chat; use null for any information not directly stated.
  
  - Normalize all monetary amounts to pure numeric values without currency symbols or abbreviations.
  
  - For victim_size, prefer explicit organizational indicators (revenue, employee count) over subjective assessments.
  
  - Classify attack_type based on what the attacker describes they have done, not what they threaten to do.
  
  - Calculate discount_percentage only when both initial_demand and final_agreed_price are available and numeric.
  
  - Determine outcome_status from the last messages in the chat; look for confirmation keywords indicating payment completion.
  
  - Set exfiltration_confirmed to true only if data theft is explicitly mentioned; use null rather than false when uncertain.
  
  - When converting textual amounts (e.g., "2 million", "500k"), apply standard multipliers: k = 1,000; M or million = 1,000,000.
  
  
  Chat JSON:
  {{chat_json}}
