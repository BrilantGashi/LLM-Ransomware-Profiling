# ==============================================================================
# LOGGING CONFIGURATION - LLM Ransomware Profiling Project
# ==============================================================================

version: 1
disable_existing_loggers: False


# ------------------------------------------------------------------------------
# FORMATTERS
# ------------------------------------------------------------------------------
formatters:
  # Standard format for console output (clean, minimal)
  standard:
    format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
    datefmt: "%H:%M:%S"
  
  # Detailed format for file logs (includes module and line number)
  detailed:
    format: "%(asctime)s - %(name)s - %(levelname)s - %(module)s:%(lineno)d - %(message)s"
    datefmt: "%Y-%m-%d %H:%M:%S"
  
  # Minimal format for console (clean output, as per run_pipeline design)
  minimal:
    format: "⚠️  %(message)s"
  
  # Error report format 
  error_report:
    format: "[%(asctime)s] %(levelname)s in %(name)s (%(module)s:%(lineno)d)\n%(message)s\n"
    datefmt: "%Y-%m-%d %H:%M:%S"


# ------------------------------------------------------------------------------
# HANDLERS
# ------------------------------------------------------------------------------
handlers:
  # Console handler - WARNING level only (clean stdout)
  console:
    class: logging.StreamHandler
    level: WARNING
    formatter: minimal
    stream: ext://sys.stdout
  
  # Main file handler - DEBUG level (verbose logging)
  file_handler:
    class: logging.FileHandler
    level: DEBUG
    formatter: detailed
    filename: "logs/project.log"
    mode: "a"
    encoding: "utf8"
  
  # Rotating file handler for production (prevents huge log files)
  rotating_file:
    class: logging.handlers.RotatingFileHandler
    level: DEBUG
    formatter: detailed
    filename: "logs/pipeline_rotating.log"
    maxBytes: 10485760  # 10MB
    backupCount: 5
    encoding: "utf8"
  
  # Error-only handler (for critical issues reporting)
  error_file:
    class: logging.FileHandler
    level: ERROR
    formatter: error_report
    filename: "logs/errors.log"
    mode: "a"
    encoding: "utf8"
  
  # API errors handler (UniBS cluster specific,)
  api_error_file:
    class: logging.FileHandler
    level: WARNING
    formatter: error_report
    filename: "logs/api_errors.log"
    mode: "a"
    encoding: "utf8"


# ------------------------------------------------------------------------------
# LOGGERS (Module-specific configurations)
# ------------------------------------------------------------------------------
loggers:
  # Main pipeline logger
  RansomPipeline:
    level: INFO
    handlers: [console, file_handler, error_file]
    propagate: False
  
  # UniBS LLM Client logger (API calls, retries, timeouts)
  UniBS_Client:
    level: INFO
    handlers: [file_handler, api_error_file]
    propagate: False
  
  # Error handler logger (retry logic, exponential backoff)
  ErrorHandler:
    level: DEBUG
    handlers: [file_handler, error_file]
    propagate: False
  
  # Database updater logger
  DatabaseUpdater:
    level: INFO
    handlers: [console, file_handler]
    propagate: False
  
  # Consensus manager logger
  ConsensusManager:
    level: INFO
    handlers: [file_handler]
    propagate: False
  
  # Data loader logger
  DataLoader:
    level: INFO
    handlers: [file_handler]
    propagate: False
  
  # Embedding client logger (future feature)
  EmbeddingClient:
    level: INFO
    handlers: [file_handler, api_error_file]
    propagate: False
  
  # Visualizer logger
  Visualizer:
    level: INFO
    handlers: [file_handler]
    propagate: False
  
  # Aggregator logger
  Aggregator:
    level: INFO
    handlers: [file_handler]
    propagate: False
  
  # External libraries (suppress verbose output)
  openai:
    level: WARNING
    handlers: [file_handler]
    propagate: False
  
  httpx:
    level: WARNING
    handlers: [file_handler]
    propagate: False
  
  urllib3:
    level: WARNING
    handlers: [file_handler]
    propagate: False
  
  requests:
    level: WARNING
    handlers: [file_handler]
    propagate: False


# ------------------------------------------------------------------------------
# ROOT LOGGER (Fallback for unconfigured loggers)
# ------------------------------------------------------------------------------
root:
  level: WARNING
  handlers: [console, file_handler]


# ------------------------------------------------------------------------------
# NOTES
# ------------------------------------------------------------------------------
# 1. Console shows only WARNING+ (clean output during pipeline execution)
# 2. File logs capture everything at DEBUG level for troubleshooting
# 3. api_errors.log:
#    - Records timestamp, model, and error message
#    - Can be submitted to professor for persistent issues
# 4. errors.log captures all ERROR+ events across all modules
# 5. Rotating handler prevents disk space issues in production
