# Speech Act Analysis - Message-level classification
# Output: JSON array of objects (one per message)

task_name: speech_act_analysis
description: "Classify each message in ransomware negotiations using speech act theory"
output_format: "json_array"

system_prompt: |
  You are a discourse analyst specializing in speech act classification.
  You MUST return ONLY a valid JSON array. No explanations, no markdown, no extra text.
  
  CRITICAL RULES:
  - First character must be "["
  - Last character must be "]"
  - NO text before or after the JSON
  - NO markdown code blocks (```json)
  - If you cannot classify something, use "Unknown"

user_prompt: |
  TASK: Classify each message in this ransomware negotiation chat.
  
  You will receive a JSON list of messages. Each has "party" and "message" fields.
  Return a JSON array with ONE object per message, in the same order.
  
  OUTPUT SCHEMA (strict JSON array):
  [
    {
      "text": "verbatim message text here",
      "party": "Attacker" | "Victim",
      "primary_act": "INFORMATIVE_DECLARATIVE" | "DIRECTIVE" | "COMMISSIVE" | "NEGOTIATIVE_EVALUATIVE" | "EXPRESSIVE_METACOMMUNICATIVE",
      "argumentative_function": "GROUNDS_FACTS" | "ACTION_PRESSURE" | "CONDITIONAL_REASONING" | "VALUE_FAIRNESS_APPEAL" | "FACE_ETHOS_WORK" | "PROCESS_MAINTENANCE",
      "phase": "OPENING_CONTACT" | "PROOF_OF_CAPABILITY" | "DEMAND_FORMULATION" | "BARGAINING_CONCESSION" | "RESOLUTION_CLOSURE" | "OTHER"
    }
  ]
  
  LABEL DEFINITIONS (choose exactly ONE per field):
  
  primary_act:
  - INFORMATIVE_DECLARATIVE: Stating or confirming facts/status ("Payment received", "Your files are encrypted")
  - DIRECTIVE: Commands, requests, instructions ("Pay $100k", "Send 2-3 files for proof")
  - COMMISSIVE: Threats, promises, commitments ("We will delete data if you pay", "Price doubles tomorrow")
  - NEGOTIATIVE_EVALUATIVE: Offers, counteroffers, justifications ("We can do $500k", "This is fair for your company size")
  - EXPRESSIVE_METACOMMUNICATIVE: Emotions, greetings, coordination ("Thank you", "Please confirm receipt", "Are you there?")
  
  argumentative_function:
  - GROUNDS_FACTS: Establishing evidence or technical details
  - ACTION_PRESSURE: Creating urgency, deadlines, consequences
  - CONDITIONAL_REASONING: Clear if-then logic ("If you pay, we decrypt")
  - VALUE_FAIRNESS_APPEAL: Justifying what is reasonable/proportional
  - FACE_ETHOS_WORK: Building credibility, empathy, politeness
  - PROCESS_MAINTENANCE: Managing the chat (confirmations, clarifications)
  
  phase:
  - OPENING_CONTACT: First contact, incident announcement
  - PROOF_OF_CAPABILITY: Showing evidence, samples, technical proof
  - DEMAND_FORMULATION: Stating ransom amount and payment terms
  - BARGAINING_CONCESSION: Negotiation, price changes, counteroffers
  - RESOLUTION_CLOSURE: Agreement reached, payment details, final messages
  - OTHER: Does not clearly fit above categories
  
  GUIDANCE:
  - Preserve the exact original message in "text" field
  - If unclear which label applies, choose the most prominent one
  - For hybrid messages (e.g., threat + offer), pick the dominant speech act
  - Use "Unknown" only if the message is unintelligible or corrupted
  
  Chat data:
  {{chat_json}}
  
  Remember: Output ONLY the JSON array. Nothing else.

# Expected output structure for validation
expected_output:
  type: "array"
  item_schema:
    text: "string"
    party: "string (Attacker|Victim)"
    primary_act: "string (enum)"
    argumentative_function: "string (enum)"
    phase: "string (enum)"
